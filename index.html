<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Engineering Document Generator</title>
  <style>
    body { font-family: "Courier New", Courier, monospace; margin: 40px; }
    .container { max-width: 800px; margin: auto; }
    .section { margin-bottom: 20px; }
    textarea, [contenteditable] { width: 100%; min-height: 60px; font-family: inherit; }
    #compiled, .review-doc { white-space: pre-wrap; background: #f7f7f7; padding: 20px; border-radius: 5px; font-family: inherit; }
    button { padding: 5px 10px; font-size: 1rem; margin-right: 10px; margin-bottom: 10px;}
    .doc-list { margin-bottom: 20px; }
    .doc-list-item { margin-bottom: 10px; }
    .review-title { font-size: 1.1em; font-weight: bold; }
    .starred { color: gold; font-weight: bold; }
    .tags { font-size: 0.9em; color: #444; }
    #fontsize-controls button { font-size: 1.2em; }
    .high-contrast { background: #222; color: #fff; }
    .comment { font-style: italic; color: #009; }
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    <h1>Engineering Document Generator</h1>
    <div id="fontsize-controls">
      <button onclick="changeFontSize(1)">A+</button>
      <button onclick="changeFontSize(-1)">A-</button>
      <button onclick="toggleContrast()">High Contrast</button>
    </div>
    <!-- Template Builder -->
    <button onclick="showTemplateBuilder()">Template Builder</button>
    <button onclick="showReview()">Review Previous Documents</button>
    <div id="step1" class="section">
      <label for="docType">Choose document type:</label>
      <select id="docType"></select>
      <input id="tagsInput" type="text" placeholder="Add tags, e.g. project, urgent" />
      <button id="startBtn">Start</button>
    </div>

    <form id="docForm" class="hidden">
      <div id="sections"></div>
      <button type="submit">Compile Document</button>
      <button type="button" onclick="printDoc()">Print</button>
      <button type="button" onclick="saveAsPDF()">Export to PDF</button>
      <button type="button" onclick="shareEmail()">Share via Email</button>
      <button type="button" onclick="saveToDrive()">Save to Google Drive</button>
      <button type="button" onclick="saveToDropbox()">Save to Dropbox</button>
    </form>

    <div id="compiled" class="hidden"></div>
    <div id="driveStatus" style="margin-top:10px;"></div>
    <div id="reviewSection" class="hidden"></div>
    <div id="templateBuilder" class="hidden"></div>

    <!-- AI popup -->
    <div id="aiPopup" class="hidden" style="position:fixed; top:20%; left:35%; width:400px; background:#fff; border:2px solid #333; padding:20px; z-index:10;">
      <h3>AI Suggestion</h3>
      <div id="aiContent"></div>
      <button onclick="closeAIPopup()">Close</button>
    </div>
  </div>

  <script>
    // 1. Document templates and samples
    const templates = {
      "Technical Report": [
        { section: "Title", prompt: "Enter the title of the report:", sample: "Technical Report: Analysis of Water Quality", comment:"Use a descriptive title." },
        { section: "Abstract", prompt: "Write a brief summary (abstract):", sample: "This report summarizes the findings...", comment:"Summarize your report here." }
        // ... Add more sections
      ],
      "Specification": [
        { section: "Title", prompt: "Specification title:", sample: "Specification for HVAC System", comment:"State what is being specified." }
        // ... Add more sections
      ]
      // ... Add more templates
    };

    // 2. Template Builder
    function showTemplateBuilder() {
      const tb = document.getElementById('templateBuilder');
      tb.classList.remove('hidden');
      tb.innerHTML = `<h2>Template Builder (Demo)</h2>
        <label>Template Name: <input id="newTemplateName"></label>
        <div id="newTemplateSections"></div>
        <button onclick="addTemplateSection()">Add Section</button>
        <button onclick="saveNewTemplate()">Save Template</button>
        <button onclick="closeTemplateBuilder()">Close</button>`;
      addTemplateSection();
    }
    function addTemplateSection() {
      const secDiv = document.getElementById('newTemplateSections');
      const idx = secDiv.children.length;
      secDiv.innerHTML += `<div><input placeholder="Section Name" id="newSec${idx}"> 
      <input placeholder="Prompt" id="newPrompt${idx}"></div>`;
    }
    function saveNewTemplate() {
      const name = document.getElementById('newTemplateName').value;
      if (!name) return alert("Template name required!");
      const secDiv = document.getElementById('newTemplateSections');
      const sections = [];
      for(let i=0; i<secDiv.children.length; i++) {
        const sec = document.getElementById(`newSec${i}`).value;
        const prompt = document.getElementById(`newPrompt${i}`).value;
        if(sec && prompt) sections.push({section:sec, prompt, sample:"", comment:""});
      }
      templates[name] = sections;
      closeTemplateBuilder();
      loadDocTypes();
      alert("Template saved!");
    }
    function closeTemplateBuilder() {
      document.getElementById('templateBuilder').classList.add('hidden');
    }

    // 3. Load document types
    function loadDocTypes() {
      const docType = document.getElementById('docType');
      docType.innerHTML = '<option value="">-- Select --</option>';
      Object.keys(templates).forEach(type => {
        docType.innerHTML += `<option value="${type}">${type}</option>`;
      });
    }
    loadDocTypes();

    // 4. Font size and contrast
    let currentFontSize = 16;
    function changeFontSize(val) {
      currentFontSize += val;
      document.getElementById('mainContainer').style.fontSize = currentFontSize + "px";
    }
    function toggleContrast() {
      document.body.classList.toggle("high-contrast");
    }

    // 5. Document creation
    let currentDocType = "", compiledText = "", currentTags = "";
    document.getElementById('startBtn').onclick = startDocument;
    function startDocument() {
      currentDocType = document.getElementById('docType').value;
      currentTags = document.getElementById('tagsInput').value;
      if (!currentDocType) return alert('Please select a document type.');
      document.getElementById('step1').classList.add("hidden");
      document.getElementById('docForm').classList.remove("hidden");
      document.getElementById('reviewSection').classList.add("hidden");
      renderSections();
    }

    // 6. Render sections with comments, rich text, auto-save, AI help, and note fields
    function renderSections() {
      const secDiv = document.getElementById('sections');
      secDiv.innerHTML = '';
      templates[currentDocType].forEach((sec, idx) => {
        secDiv.innerHTML += `<div class="section">
          <label>${sec.prompt}</label>
          <div contenteditable="true" id="sec${idx}">${sec.sample}</div>
          <span class="comment">${sec.comment||""}</span>
          <button type="button" onclick="askAI(${idx})">Ask AI</button>
          <input id="note${idx}" placeholder="Add comment/note...">
        </div>`;
      });
    }

    // 7. Auto-save
    setInterval(() => {
      if (!currentDocType) return;
      const sections = templates[currentDocType];
      let sectionContents = [];
      sections.forEach((sec, idx) => {
        const content = document.getElementById(`sec${idx}`)?.innerText || "";
        const note = document.getElementById(`note${idx}`)?.value || "";
        sectionContents.push({section: sec.section, content, note});
      });
      localStorage.setItem('draftDoc', JSON.stringify({
        type: currentDocType,
        sections: sectionContents,
        tags: currentTags
      }));
    }, 5000);

    // 8. Compile document
    document.getElementById('docForm').onsubmit = function(e) {
      e.preventDefault();
      const sections = templates[currentDocType];
      let sectionContents = [];
      let output = `# ${currentDocType}\nTags: ${currentTags}\n\n`;
      sections.forEach((sec, idx) => {
        const content = document.getElementById(`sec${idx}`).innerText;
        const note = document.getElementById(`note${idx}`).value;
        output += `## ${sec.section}\n${content}\n`;
        if(note) output += `> Note: ${note}\n`;
        output += "\n";
        sectionContents.push({section:sec.section, content, note});
      });
      compiledText = output;
      document.getElementById('docForm').classList.add("hidden");
      document.getElementById('compiled').classList.remove("hidden");
      document.getElementById('compiled').textContent = output;
      saveDocumentLocally(currentDocType, sectionContents, output, currentTags);
    };

    // 9. Save locally with versioning, starring, and tags
    function saveDocumentLocally(docType, sections, output, tags) {
      let docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      docs.push({
        type: docType,
        sections: sections,
        compiled: output,
        date: new Date().toISOString(),
        tags: tags,
        starred: false,
        versions: [] // For version history
      });
      localStorage.setItem('engineeringDocs', JSON.stringify(docs));
    }

    // 10. Print, PDF, Email, Cloud (simple demos)
    function printDoc() { window.print(); }
    function saveAsPDF() { alert("PDF export: Use browser's 'Print to PDF' for now."); }
    function shareEmail() {
      let subject = encodeURIComponent("Engineering Document: " + currentDocType);
      let body = encodeURIComponent(compiledText);
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }
    function saveToDrive() { alert("Google Drive integration not configured in this demo."); }
    function saveToDropbox() { alert("Dropbox integration not configured in this demo."); }

    // 11. Review, search, edit, star, version, tagging
    function showReview() {
      document.getElementById('step1').classList.add("hidden");
      document.getElementById('docForm').classList.add("hidden");
      document.getElementById('compiled').classList.add("hidden");
      document.getElementById('reviewSection').classList.remove("hidden");
      renderReviewList();
    }
    function renderReviewList() {
      let docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      const reviewDiv = document.getElementById('reviewSection');
      let html = `<input id="searchBar" placeholder="Search..." oninput="searchDocs()">`;
      html += "<div class='doc-list'>";
      docs.forEach((doc, idx) => {
        html += `<div class='doc-list-item'>
          <span class='review-title'>${doc.type}</span>
          ${doc.starred ? '<span class="starred">&#9733;</span>' : `<button onclick="starDoc(${idx})">&#9734;</button>`}
          <span class="tags">${doc.tags ? "Tags: "+doc.tags : ""}</span>
          (${(new Date(doc.date)).toLocaleString()})
          <button onclick='viewDocument(${idx})'>View</button>
          <button onclick='editDocument(${idx})'>Edit</button>
          <button onclick='deleteDocument(${idx})'>Delete</button>
        </div>`;
      });
      html += "</div><button onclick='backToMain()'>Back</button><div id='docView'></div>";
      reviewDiv.innerHTML = html;
    }
    function searchDocs() {
      let query = document.getElementById('searchBar').value.toLowerCase();
      let docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      docs = docs.filter(doc => doc.type.toLowerCase().includes(query) || doc.compiled.toLowerCase().includes(query) || (doc.tags||"").toLowerCase().includes(query));
      const docList = document.querySelector('.doc-list');
      docList.innerHTML = '';
      docs.forEach((doc, idx) => {
        docList.innerHTML += `<div class='doc-list-item'>
          <span class='review-title'>${doc.type}</span>
          ${doc.starred ? '<span class="starred">&#9733;</span>' : `<button onclick="starDoc(${idx})">&#9734;</button>`}
          <span class="tags">${doc.tags ? "Tags: "+doc.tags : ""}</span>
          (${(new Date(doc.date)).toLocaleString()})
          <button onclick='viewDocument(${idx})'>View</button>
          <button onclick='editDocument(${idx})'>Edit</button>
          <button onclick='deleteDocument(${idx})'>Delete</button>
        </div>`;
      });
    }
    function viewDocument(idx) {
      let docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      const doc = docs[idx];
      document.getElementById('docView').innerHTML = `<div class='review-doc'>${doc.compiled}<br>
        <button onclick='revertVersion(${idx})'>Revert to previous version</button>
        </div>`;
    }
    function deleteDocument(idx) {
      if (!confirm("Delete this document?")) return;
      let docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      docs.splice(idx, 1);
      localStorage.setItem('engineeringDocs', JSON.stringify(docs));
      renderReviewList();
    }
    function backToMain() {
      document.getElementById('reviewSection').classList.add("hidden");
      document.getElementById('step1').classList.remove("hidden");
    }
    function editDocument(idx) {
      let docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      const doc = docs[idx];
      currentDocType = doc.type;
      currentTags = doc.tags;
      document.getElementById('step1').classList.add("hidden");
      document.getElementById('docForm').classList.remove("hidden");
      document.getElementById('reviewSection').classList.add("hidden");
      templates[currentDocType].forEach((sec, sidx) => {
        sec.sample = doc.sections[sidx]?.content || "";
      });
      renderSections();
    }
    function starDoc(idx) {
      let docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      docs[idx].starred = !docs[idx].starred;
      localStorage.setItem('engineeringDocs', JSON.stringify(docs));
      renderReviewList();
    }
    function revertVersion(idx) {
      alert("Version history demo: Would load previous version if available.");
    }

    // 12. AI Help (demo)
    function askAI(idx) {
      const content = document.getElementById(`sec${idx}`).innerText;
      document.getElementById('aiPopup').classList.remove('hidden');
      document.getElementById('aiContent').innerHTML = `<i>AI suggestion for improvement:</i><br>${content.length < 30 ? "Try expanding your statement with more detail." : "Your statement is clear and well-written."}`;
      // For real AI, send content to an API and show the response.
    }
    function closeAIPopup() {
      document.getElementById('aiPopup').classList.add('hidden');
    }

    // On page load, restore font size and contrast from localStorage (accessibility)
    window.onload = function() {
      let fs = localStorage.getItem('fontSize');
      if(fs) { currentFontSize = parseInt(fs); document.getElementById('mainContainer').style.fontSize = currentFontSize + "px"; }
      if(localStorage.getItem('contrast') === "true") document.body.classList.add("high-contrast");
    };
  </script>
</body>
</html>
