<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Engineering Document Generator</title>
  <style>
    body { font-family: "Courier New", Courier, monospace; margin: 40px; }
    .container { max-width: 700px; margin: auto; }
    .section { margin-bottom: 20px; }
    textarea { width: 100%; min-height: 60px; font-family: inherit; }
    #compiled, .review-doc { white-space: pre-wrap; background: #f7f7f7; padding: 20px; border-radius: 5px; font-family: inherit; }
    button { padding: 10px 20px; font-size: 1rem; margin-right: 10px; margin-bottom: 10px;}
    label { font-weight: bold; }
    .hidden { display: none; }
    .doc-list { margin-bottom: 20px; }
    .doc-list-item { margin-bottom: 10px; }
    .review-title { font-size: 1.1em; font-weight: bold; }
  </style>
  <!-- Google API scripts can be added here if needed -->
</head>
<body>
  <div class="container">
    <h1>Engineering Document Generator</h1>
    <div id="step1" class="section">
      <label for="docType">Choose document type:</label>
      <select id="docType">
        <option value="">-- Select --</option>
        <option value="Technical Report">Technical Report</option>
        <option value="Specification">Specification</option>
        <option value="Risk Assessment">Risk Assessment</option>
        <option value="Project Charter">Project Charter</option>
        <option value="Safety Report">Safety Report</option>
        <option value="Change Request">Change Request</option>
        <option value="Design Review">Design Review</option>
        <option value="First of Class Test Report">First of Class Test Report</option>
        <option value="VCRM Update">VCRM Update</option>
        <option value="As Built Update">As Built Update</option>
      </select>
      <button id="startBtn">Start</button>
      <button id="reviewBtn">Review Previous Documents</button>
    </div>

    <form id="docForm" class="hidden">
      <div id="sections"></div>
      <button type="submit">Compile Document</button>
    </form>

    <div id="compiled" class="hidden"></div>
    <button id="saveDriveBtn" class="hidden" onclick="saveToDrive()">Save to Google Drive</button>
    <div id="driveStatus" style="margin-top:10px;"></div>
    <div id="reviewSection" class="hidden"></div>
  </div>

  <script>
    // Document templates and samples
    const templates = {
      "Technical Report": [
        { section: "Title", prompt: "Enter the title of the report:", sample: "Technical Report: Analysis of Water Quality" },
        { section: "Abstract", prompt: "Write a brief summary (abstract):", sample: "This report summarizes the findings of water quality analysis conducted in August 2025." },
        { section: "Introduction", prompt: "Describe the background and objectives:", sample: "The purpose of this report is to evaluate the water quality of the local reservoir." },
        { section: "Methodology", prompt: "Explain the methods used:", sample: "Samples were collected and analyzed using standard EPA methods." },
        { section: "Results", prompt: "Summarize the results found:", sample: "Results show acceptable levels of contaminants within regulatory limits." },
        { section: "Discussion", prompt: "Discuss the implications:", sample: "Results indicate safe conditions but ongoing monitoring is recommended." },
        { section: "Conclusion", prompt: "Provide the conclusion:", sample: "Water quality is currently safe for consumption." },
        { section: "References", prompt: "List references:", sample: "EPA Method 525.2, Water Safety Guidelines 2024." }
      ],
      "Specification": [
        { section: "Title", prompt: "Enter the specification title:", sample: "Specification for HVAC System" },
        { section: "Scope", prompt: "Define the scope:", sample: "This specification covers design and installation requirements for HVAC in commercial buildings." },
        { section: "Requirements", prompt: "List requirements:", sample: "1. System must maintain 20-22Â°C\n2. Airflow must meet ASHRAE 62.1 standards." },
        { section: "Design", prompt: "Describe the design:", sample: "Centralized system with variable air volume control." },
        { section: "Testing", prompt: "Describe testing procedures:", sample: "System must pass pressure and leak tests upon installation." }
      ],
      "Risk Assessment": [
        { section: "Title", prompt: "Report title:", sample: "Risk Assessment: Construction Site" },
        { section: "Objective", prompt: "State objectives:", sample: "Identify and assess potential hazards at the site." },
        { section: "Methodology", prompt: "Describe risk assessment method:", sample: "Risk matrix and on-site hazard survey conducted." },
        { section: "Findings", prompt: "Summarize findings:", sample: "Major risks include falling objects and machinery operation." },
        { section: "Mitigation Measures", prompt: "List mitigation measures:", sample: "Implement PPE usage, daily safety briefings, and site fencing." },
        { section: "Conclusion", prompt: "Provide conclusion:", sample: "Residual risk is acceptable with controls in place." }
      ],
      "Project Charter": [
        { section: "Project Name", prompt: "Project name:", sample: "New Bridge Construction" },
        { section: "Background", prompt: "Project background:", sample: "The city requires a new bridge to improve traffic flow." },
        { section: "Objectives", prompt: "Project objectives:", sample: "Complete bridge construction by Dec 2026 within budget." },
        { section: "Scope", prompt: "Define project scope:", sample: "Design, build, and commission a four-lane bridge." },
        { section: "Stakeholders", prompt: "List stakeholders:", sample: "City council, local residents, contractors, suppliers." },
        { section: "Budget", prompt: "State estimated budget:", sample: "$50 million" },
        { section: "Timeline", prompt: "Project timeline:", sample: "Start: Jan 2026; End: Dec 2026" }
      ],
      "Safety Report": [
        { section: "Title", prompt: "Report title:", sample: "Safety Report: Manufacturing Facility" },
        { section: "Executive Summary", prompt: "Write summary:", sample: "Facility safety performance improved over last year." },
        { section: "Incidents", prompt: "Describe incidents:", sample: "Two minor injuries reported, no fatalities." },
        { section: "Corrective Actions", prompt: "List actions taken:", sample: "Implemented new safety signage and PPE protocol." },
        { section: "Recommendations", prompt: "Provide recommendations:", sample: "Increase safety training frequency." }
      ],
      "Change Request": [
        { section: "Title", prompt: "Change request title:", sample: "Change Request: Extend Project Deadline" },
        { section: "Description", prompt: "Describe the change:", sample: "Request to extend the project deadline by 2 months due to supply delays." },
        { section: "Impact Analysis", prompt: "Analyze impact:", sample: "Minimal impact on budget, but stakeholders must be notified." },
        { section: "Approval", prompt: "Approval required from:", sample: "Project Manager, Sponsor" }
      ],
      "Design Review": [
        { section: "Title", prompt: "Review title:", sample: "Design Review: Solar Panel Array" },
        { section: "Purpose", prompt: "Purpose of review:", sample: "Assess design for compliance with specifications." },
        { section: "Design Overview", prompt: "Provide overview:", sample: "System includes 100 panels, grid-tied, with inverter." },
        { section: "Issues Identified", prompt: "List issues:", sample: "Potential shading in northeast corner during winter." },
        { section: "Recommendations", prompt: "Provide recommendations:", sample: "Relocate panels to maximize sunlight exposure." },
        { section: "Conclusion", prompt: "Conclusion:", sample: "Design meets requirements with minor modifications." }
      ],
      "First of Class Test Report": [
        { section: "Title", prompt: "Enter the test report title:", sample: "FCTR: Rail Vehicle Brake Test" },
        { section: "Purpose", prompt: "Describe the purpose of the test:", sample: "Verify brake system meets design criteria." },
        { section: "Test Description", prompt: "Detailed description:", sample: "Test conducted on prototype vehicle under dry conditions." },
        { section: "Test Results", prompt: "Summarize results:", sample: "Braking distance within required limit." },
        { section: "Analysis", prompt: "Analysis of results:", sample: "System performs as expected; minor adjustment needed." },
        { section: "Conclusion", prompt: "Conclusion and recommendations:", sample: "Brake system approved pending adjustment." },
        { section: "Sign Off", prompt: "Sign-off names:", sample: "Lead Engineer, QA Manager" }
      ],
      "VCRM Update": [
        { section: "Title", prompt: "Update title:", sample: "VCRM Update: New Environmental Regulation" },
        { section: "Background", prompt: "Background of update:", sample: "New regulation impacts product compliance requirements." },
        { section: "Change Description", prompt: "Describe changes:", sample: "Updated materials list to include compliant alternatives." },
        { section: "Affected Requirements", prompt: "List affected requirements:", sample: "Req-123, Req-456" },
        { section: "Verification Plan", prompt: "Verification plan:", sample: "Lab testing and documentation review." },
        { section: "Approval", prompt: "Approval names:", sample: "Compliance Lead, Project Sponsor" }
      ],
      "As Built Update": [
        { section: "Title", prompt: "Update title:", sample: "As Built Update: Mechanical Room Layout" },
        { section: "Background", prompt: "Background for the update:", sample: "Minor changes to pipe routing after installation." },
        { section: "Update Details", prompt: "Details of update:", sample: "Pipe A moved 20cm left; cable tray rerouted." },
        { section: "Documentation Changes", prompt: "Documentation updates:", sample: "Revised drawing 101-A and updated spec sheet." },
        { section: "Compliance", prompt: "Compliance status:", sample: "All changes comply with project specifications." },
        { section: "Sign Off", prompt: "Sign-off names:", sample: "Mechanical Lead, Construction Supervisor" }
      ]
    };

    let currentDocType = "";
    let compiledText = "";

    // Helper for local storage
    function saveDocumentLocally(docType, sections, output) {
      const docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      docs.push({
        type: docType,
        sections: sections,
        compiled: output,
        date: new Date().toISOString()
      });
      localStorage.setItem('engineeringDocs', JSON.stringify(docs));
    }

    function startDocument() {
      currentDocType = document.getElementById('docType').value;
      if (!currentDocType) { alert('Please select a document type.'); return; }
      document.getElementById('step1').classList.add("hidden");
      document.getElementById('docForm').classList.remove("hidden");
      document.getElementById('saveDriveBtn').classList.add("hidden");
      document.getElementById('compiled').classList.add("hidden");
      document.getElementById('reviewSection').classList.add("hidden");
      document.getElementById('driveStatus').textContent = "";

      // Render sections
      const sectionsDiv = document.getElementById('sections');
      sectionsDiv.innerHTML = '';
      templates[currentDocType].forEach((sec, idx) => {
        const s = document.createElement('div');
        s.className = "section";
        s.innerHTML = `<label>${sec.prompt}</label>
          <textarea name="sec${idx}" required>${sec.sample}</textarea>`;
        sectionsDiv.appendChild(s);
      });
    }

    function compileDocument(e) {
      e.preventDefault();
      const form = document.getElementById('docForm');
      const compiledDiv = document.getElementById('compiled');
      let output = `# ${currentDocType}\n\n`;
      const sections = templates[currentDocType];
      let sectionContents = [];
      sections.forEach((sec, idx) => {
        const content = form[`sec${idx}`].value;
        output += `## ${sec.section}\n${content}\n\n`;
        sectionContents.push({section: sec.section, content});
      });
      compiledText = output;
      form.classList.add("hidden");
      compiledDiv.classList.remove("hidden");
      compiledDiv.textContent = output;
      document.getElementById('saveDriveBtn').classList.remove("hidden");
      saveDocumentLocally(currentDocType, sectionContents, output);
    }

    // --- Review Previous Documents ---
    function showReview() {
      document.getElementById('step1').classList.add("hidden");
      document.getElementById('docForm').classList.add("hidden");
      document.getElementById('compiled').classList.add("hidden");
      document.getElementById('saveDriveBtn').classList.add("hidden");
      document.getElementById('reviewSection').classList.remove("hidden");
      renderReviewList();
    }

    function renderReviewList() {
      const docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      const reviewDiv = document.getElementById('reviewSection');
      if (docs.length === 0) {
        reviewDiv.innerHTML = "<p>No previous documents found.</p><button onclick='backToMain()'>Back</button>";
        return;
      }
      let html = "<div class='doc-list'>";
      docs.forEach((doc, idx) => {
        html += `<div class='doc-list-item'>
          <span class='review-title'>${doc.type}</span> (${(new Date(doc.date)).toLocaleString()})
          <button onclick='viewDocument(${idx})'>View</button>
          <button onclick='deleteDocument(${idx})'>Delete</button>
        </div>`;
      });
      html += "</div><button onclick='backToMain()'>Back</button><div id='docView'></div>";
      reviewDiv.innerHTML = html;
    }

    function viewDocument(idx) {
      const docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      const doc = docs[idx];
      document.getElementById('docView').innerHTML = `<div class='review-doc'>${doc.compiled}</div>`;
    }

    function deleteDocument(idx) {
      if (!confirm("Delete this document?")) return;
      let docs = JSON.parse(localStorage.getItem('engineeringDocs') || '[]');
      docs.splice(idx, 1);
      localStorage.setItem('engineeringDocs', JSON.stringify(docs));
      renderReviewList();
    }

    function backToMain() {
      document.getElementById('reviewSection').classList.add("hidden");
      document.getElementById('step1').classList.remove("hidden");
    }

    // --- Event Listeners for Buttons ---
    document.getElementById('startBtn').addEventListener('click', startDocument);
    document.getElementById('reviewBtn').addEventListener('click', showReview);
    document.getElementById('docForm').addEventListener('submit', compileDocument);

    // Google Drive integration placeholder
    function saveToDrive() {
      alert("Google Drive integration not configured in this demo. See README for setup instructions.");
      // For integration, see previous code or README.
    }
  </script>
</body>
</html>
