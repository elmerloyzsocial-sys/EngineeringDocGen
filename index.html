<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Engineering Document Generator</title>
  <style>
    body { font-family: "Courier New", Courier, monospace; margin: 40px; background: #faf8f2;}
    .container { max-width: 800px; margin: auto; }
    .section { margin-bottom: 20px; }
    textarea, [contenteditable] { width: 100%; min-height: 60px; font-family: inherit; }
    #compiled, .review-doc { white-space: pre-wrap; background: #f7f7f7; padding: 20px; border-radius: 5px; font-family: inherit; }
    button { padding: 6px 14px; font-size: 1rem; margin-right: 10px; margin-bottom: 10px;}
    label { font-weight: bold; }
    .hidden { display: none; }
    #fontsize-controls button { font-size: 1.2em; }
    .comment { font-style: italic; color: #009; }
    #aiPopup {
      position: fixed;
      right: 40px;
      bottom: 40px;
      width: 320px;
      background: #fff;
      border: 2px solid #333;
      padding: 20px;
      z-index: 10;
      border-radius: 12px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.15);
      transition: opacity 0.2s;
    }
    #aiPopup h3 { margin-top: 0; }
    #aiPopup button { float: right; margin-top: 10px;}
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    <h1>Engineering Document Generator</h1>
    <div id="fontsize-controls">
      <button onclick="changeFontSize(1)">A+</button>
      <button onclick="changeFontSize(-1)">A-</button>
    </div>
    <div id="step1" class="section">
      <label for="docType">Choose document type:</label>
      <select id="docType"></select>
      <button id="startBtn">Start</button>
    </div>

    <form id="docForm" class="hidden">
      <div id="sections"></div>
      <button type="submit">Compile Document</button>
      <button type="button" id="backBtnForm">Back to Home</button>
    </form>

    <div id="compiled" class="hidden"></div>
    <button type="button" id="downloadTxtBtn" class="hidden">Download as TXT</button>
    <button type="button" id="backBtnCompiled" class="hidden">Back to Home</button>

    <div id="aiPopup" class="hidden">
      <h3>AI Suggestion</h3>
      <div id="aiContent"></div>
      <button id="closeAIPopupBtn" type="button">Close</button>
    </div>
  </div>

  <script>
    const templates = {
      "Technical Report": [
        { section: "Title", prompt: "Enter the title of the report:", sample: "Technical Report: Analysis of Water Quality", comment:"Use a descriptive title." },
        { section: "Abstract", prompt: "Write a brief summary (abstract):", sample: "This report summarizes the findings...", comment:"Summarize your report here." },
        { section: "Introduction", prompt: "Describe the background and objectives:", sample: "The purpose of this report is to evaluate the water quality of the local reservoir.", comment:"Provide background and objectives." },
        { section: "Methodology", prompt: "Explain the methods used:", sample: "Samples were collected and analyzed using standard EPA methods.", comment:"Describe the approach and methods." },
        { section: "Results", prompt: "Summarize the results found:", sample: "Results show acceptable levels of contaminants within regulatory limits.", comment:"Summarize what you found." },
        { section: "Discussion", prompt: "Discuss the implications:", sample: "Results indicate safe conditions but ongoing monitoring is recommended.", comment:"Discuss what results mean." },
        { section: "Conclusion", prompt: "Provide the conclusion:", sample: "Water quality is currently safe for consumption.", comment:"State your main conclusion." },
        { section: "References", prompt: "List references:", sample: "EPA Method 525.2, Water Safety Guidelines 2024.", comment:"List sources." }
      ],
      "Specification": [
        { section: "Title", prompt: "Specification title:", sample: "Specification for HVAC System", comment:"State what is being specified." },
        { section: "Scope", prompt: "Define the scope:", sample: "This specification covers design and installation requirements for HVAC in commercial buildings.", comment:"Describe boundaries." },
        { section: "Requirements", prompt: "List requirements:", sample: "1. System must maintain 20-22Â°C\n2. Airflow must meet ASHRAE 62.1 standards.", comment:"List all requirements." },
        { section: "Design", prompt: "Describe the design:", sample: "Centralized system with variable air volume control.", comment:"Describe design features." },
        { section: "Testing", prompt: "Describe testing procedures:", sample: "System must pass pressure and leak tests upon installation.", comment:"Describe testing." }
      ],
      "First of Class Test Procedure": [
        { section: "Title", prompt: "Test procedure title:", sample: "First of Class Test Procedure: Vehicle Brake System", comment: "State the name of the procedure." },
        { section: "Purpose", prompt: "Purpose of the procedure:", sample: "To verify the brake system meets all design and safety requirements.", comment: "Why is this test performed?" },
        { section: "Scope", prompt: "Scope of testing:", sample: "Testing applies to the first completed production vehicle.", comment: "Define the boundaries." },
        { section: "Test Equipment", prompt: "Equipment required:", sample: "Brake tester, data logger, speed sensors.", comment: "List test equipment." },
        { section: "Test Steps", prompt: "Step-by-step procedure:", sample: "1. Inspect brake components. 2. Conduct static test. 3. Perform dynamic braking test at designated speeds.", comment: "List all steps clearly." },
        { section: "Expected Results", prompt: "Expected results:", sample: "Brakes must stop vehicle within required distance and show no abnormal wear.", comment: "Define what results are expected." },
        { section: "Pass/Fail Criteria", prompt: "Pass/fail criteria:", sample: "Test passes if stopping distance and system checks meet specification.", comment: "How do you define pass/fail?" },
        { section: "Sign Off", prompt: "Sign-off names and roles:", sample: "Lead Test Engineer, QA Manager", comment: "Who approves?" }
      ],
      "VCRM Update": [
        { section: "Title", prompt: "Update title:", sample: "VCRM Update: Compliance Requirement Change", comment:"Name the update." },
        { section: "Background", prompt: "Background of update:", sample: "New regulatory requirements for emissions have been published.", comment:"Why is update needed?" },
        { section: "Change Description", prompt: "Describe changes:", sample: "Added new emissions limits to compliance matrix.", comment:"What is changing?" },
        { section: "Affected Requirements", prompt: "List affected requirements:", sample: "REQ-009, REQ-022", comment:"Which requirements are affected?" },
        { section: "Verification Plan", prompt: "Verification plan:", sample: "Schedule laboratory tests and update compliance documentation.", comment:"How will you check the change?" },
        { section: "Approval", prompt: "Approval names:", sample: "Regulatory Lead, Engineering Manager", comment:"Who approves the update?" }
      ],
      "As Built Update": [
        { section: "Title", prompt: "Update title:", sample: "As Built Update: Chiller Pipe Layout", comment:"Name the update." },
        { section: "Background", prompt: "Background for the update:", sample: "Field routing of pipes differed from design drawings due to obstacles.", comment:"Why was update needed?" },
        { section: "Update Details", prompt: "Details of update:", sample: "Pipe B rerouted above ceiling grid, supports added.", comment:"Explain what changed." },
        { section: "Documentation Changes", prompt: "Documentation updates:", sample: "Revised layout drawing 115-C. Updated bill of materials.", comment:"What documentation changed?" },
        { section: "Compliance", prompt: "Compliance status:", sample: "All changes comply with project specifications and safety codes.", comment:"Are changes compliant?" },
        { section: "Sign Off", prompt: "Sign-off names:", sample: "Project Engineer, Construction Supervisor", comment:"Who signs off?" }
      ]
    };

    function loadDocTypes() {
      const docType = document.getElementById('docType');
      docType.innerHTML = '<option value="">-- Select --</option>';
      Object.keys(templates).forEach(type => {
        docType.innerHTML += `<option value="${type}">${type}</option>`;
      });
    }
    loadDocTypes();

    let currentFontSize = 16;
    function changeFontSize(val) {
      currentFontSize += val;
      document.getElementById('mainContainer').style.fontSize = currentFontSize + "px";
    }

    let currentDocType = "", compiledText = "";
    document.getElementById('startBtn').onclick = startDocument;

    function startDocument() {
      currentDocType = document.getElementById('docType').value;
      if (!currentDocType) return alert('Please select a document type.');
      document.getElementById('step1').classList.add("hidden");
      document.getElementById('docForm').classList.remove("hidden");
      document.getElementById('compiled').classList.add("hidden");
      document.getElementById('downloadTxtBtn').classList.add("hidden");
      document.getElementById('backBtnCompiled').classList.add("hidden");
      renderSections();
    }

    function renderSections() {
      const secDiv = document.getElementById('sections');
      secDiv.innerHTML = '';
      templates[currentDocType].forEach((sec, idx) => {
        secDiv.innerHTML += `<div class="section">
          <label>${sec.prompt}</label>
          <div contenteditable="true" id="sec${idx}">${sec.sample}</div>
          <span class="comment">${sec.comment||""}</span>
          <button type="button" onclick="askAI(${idx})">Ask AI</button>
        </div>`;
      });
    }

    document.getElementById('docForm').onsubmit = function(e) {
      e.preventDefault();
      const sections = templates[currentDocType];
      let output = `# ${currentDocType}\n\n`;
      sections.forEach((sec, idx) => {
        const content = document.getElementById(`sec${idx}`).innerText;
        output += `## ${sec.section}\n${content}\n\n`;
      });
      compiledText = output;
      document.getElementById('docForm').classList.add("hidden");
      document.getElementById('compiled').classList.remove("hidden");
      document.getElementById('compiled').textContent = output;
      document.getElementById('downloadTxtBtn').classList.remove("hidden");
      document.getElementById('backBtnCompiled').classList.remove("hidden");
    };

    // Add Back to Home logic
    document.getElementById('backBtnForm').onclick = function() {
      document.getElementById('docForm').classList.add("hidden");
      document.getElementById('step1').classList.remove("hidden");
      document.getElementById('compiled').classList.add("hidden");
      document.getElementById('downloadTxtBtn').classList.add("hidden");
      document.getElementById('backBtnCompiled').classList.add("hidden");
    };
    document.getElementById('backBtnCompiled').onclick = function() {
      document.getElementById('compiled').classList.add("hidden");
      document.getElementById('step1').classList.remove("hidden");
      document.getElementById('downloadTxtBtn').classList.add("hidden");
      document.getElementById('backBtnCompiled').classList.add("hidden");
    };

    // Download as TXT feature
    document.getElementById('downloadTxtBtn').onclick = function() {
      const filename = (currentDocType || "document") + ".txt";
      const blob = new Blob([compiledText], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };

    function askAI(idx) {
      const content = document.getElementById(`sec${idx}`).innerText.trim();
      let suggestion = "";
      if (!content) {
        suggestion = "Try to start with a simple statement about this section. For example: 'This report analyzes ...'";
      } else if (content.length < 30) {
        suggestion = "Consider expanding your statement with more detail. Provide additional context or examples.";
      } else if (/requirement|design|test|interface|verification|procedure|update|change/i.test(content)) {
        suggestion = "Ensure you clearly list requirements, design/test procedures, interface details, or update/change reasons. Use bullet points for clarity if needed.";
      } else if (/conclusion|summary|recommend|acceptance|approval|sign off/i.test(content)) {
        suggestion = "Summarize your main findings, recommendations, acceptance criteria, or approval process concisely.";
      } else {
        suggestion = "Your statement looks good. Double-check for clarity, completeness, and technical accuracy.";
      }
      showAIPopup(suggestion);
    }
    function showAIPopup(text) {
      document.getElementById('aiContent').innerHTML = text;
      document.getElementById('aiPopup').classList.remove('hidden');
    }
    document.getElementById('closeAIPopupBtn').addEventListener('click', function() {
      document.getElementById('aiPopup').classList.add('hidden');
      document.getElementById('aiContent').innerHTML = "";
    });
  </script>
</body>
</html>
