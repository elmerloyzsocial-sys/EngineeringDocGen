<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Engineering Document Generator</title>
  <style>
    body { font-family: "Courier New", Courier, monospace; margin: 40px; background: #faf8f2;}
    .container { max-width: 800px; margin: auto; }
    .section { margin-bottom: 20px; }
    textarea, [contenteditable] { width: 100%; min-height: 60px; font-family: inherit; }
    #compiled, .review-doc { white-space: pre-wrap; background: #f7f7f7; padding: 20px; border-radius: 5px; font-family: inherit; }
    button { padding: 6px 14px; font-size: 1rem; margin-right: 10px; margin-bottom: 10px;}
    label { font-weight: bold; }
    .hidden { display: none; }
    #fontsize-controls button { font-size: 1.2em; }
    .comment { font-style: italic; color: #009; }
    /* AI popup */
    #aiPopup {
      position: fixed; top: 20%; left: 50%; transform: translate(-50%, 0);
      width: 400px; background: #fff; border: 2px solid #333; padding: 20px; z-index: 10;
      border-radius: 12px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.2);
    }
    #aiPopup h3 { margin-top: 0; }
    #aiPopup button { float: right;}
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    <h1>Engineering Document Generator</h1>
    <div id="fontsize-controls">
      <button onclick="changeFontSize(1)">A+</button>
      <button onclick="changeFontSize(-1)">A-</button>
    </div>
    <div id="step1" class="section">
      <label for="docType">Choose document type:</label>
      <select id="docType"></select>
      <button id="startBtn">Start</button>
    </div>

    <form id="docForm" class="hidden">
      <div id="sections"></div>
      <button type="submit">Compile Document</button>
    </form>

    <div id="compiled" class="hidden"></div>

    <!-- AI popup -->
    <div id="aiPopup" class="hidden">
      <h3>AI Suggestion</h3>
      <div id="aiContent"></div>
      <button id="closeAIPopupBtn">Close</button>
    </div>
  </div>

  <script>
    // Document templates
    const templates = {
      "Technical Report": [
        { section: "Title", prompt: "Enter the title of the report:", sample: "Technical Report: Analysis of Water Quality", comment:"Use a descriptive title." },
        { section: "Abstract", prompt: "Write a brief summary (abstract):", sample: "This report summarizes the findings...", comment:"Summarize your report here." },
        { section: "Introduction", prompt: "Describe the background and objectives:", sample: "The purpose of this report is to evaluate the water quality of the local reservoir.", comment:"Provide background and objectives." },
        { section: "Methodology", prompt: "Explain the methods used:", sample: "Samples were collected and analyzed using standard EPA methods.", comment:"Describe the approach and methods." },
        { section: "Results", prompt: "Summarize the results found:", sample: "Results show acceptable levels of contaminants within regulatory limits.", comment:"Summarize what you found." },
        { section: "Discussion", prompt: "Discuss the implications:", sample: "Results indicate safe conditions but ongoing monitoring is recommended.", comment:"Discuss what results mean." },
        { section: "Conclusion", prompt: "Provide the conclusion:", sample: "Water quality is currently safe for consumption.", comment:"State your main conclusion." },
        { section: "References", prompt: "List references:", sample: "EPA Method 525.2, Water Safety Guidelines 2024.", comment:"List sources." }
      ],
      "Specification": [
        { section: "Title", prompt: "Specification title:", sample: "Specification for HVAC System", comment:"State what is being specified." },
        { section: "Scope", prompt: "Define the scope:", sample: "This specification covers design and installation requirements for HVAC in commercial buildings.", comment:"Describe boundaries." },
        { section: "Requirements", prompt: "List requirements:", sample: "1. System must maintain 20-22Â°C\n2. Airflow must meet ASHRAE 62.1 standards.", comment:"List all requirements." },
        { section: "Design", prompt: "Describe the design:", sample: "Centralized system with variable air volume control.", comment:"Describe design features." },
        { section: "Testing", prompt: "Describe testing procedures:", sample: "System must pass pressure and leak tests upon installation.", comment:"Describe testing." }
      ]
      // Add other document types as needed
    };

    // Load document types
    function loadDocTypes() {
      const docType = document.getElementById('docType');
      docType.innerHTML = '<option value="">-- Select --</option>';
      Object.keys(templates).forEach(type => {
        docType.innerHTML += `<option value="${type}">${type}</option>`;
      });
    }
    loadDocTypes();

    // Font size controls
    let currentFontSize = 16;
    function changeFontSize(val) {
      currentFontSize += val;
      document.getElementById('mainContainer').style.fontSize = currentFontSize + "px";
    }

    // Document creation
    let currentDocType = "", compiledText = "";
    document.getElementById('startBtn').onclick = startDocument;

    function startDocument() {
      currentDocType = document.getElementById('docType').value;
      if (!currentDocType) return alert('Please select a document type.');
      document.getElementById('step1').classList.add("hidden");
      document.getElementById('docForm').classList.remove("hidden");
      renderSections();
    }

    // Render sections with Ask AI
    function renderSections() {
      const secDiv = document.getElementById('sections');
      secDiv.innerHTML = '';
      templates[currentDocType].forEach((sec, idx) => {
        secDiv.innerHTML += `<div class="section">
          <label>${sec.prompt}</label>
          <div contenteditable="true" id="sec${idx}">${sec.sample}</div>
          <span class="comment">${sec.comment||""}</span>
          <button type="button" onclick="askAI(${idx})">Ask AI</button>
        </div>`;
      });
    }

    // Compile document
    document.getElementById('docForm').onsubmit = function(e) {
      e.preventDefault();
      const sections = templates[currentDocType];
      let output = `# ${currentDocType}\n\n`;
      sections.forEach((sec, idx) => {
        const content = document.getElementById(`sec${idx}`).innerText;
        output += `## ${sec.section}\n${content}\n\n`;
      });
      compiledText = output;
      document.getElementById('docForm').classList.add("hidden");
      document.getElementById('compiled').classList.remove("hidden");
      document.getElementById('compiled').textContent = output;
    };

    // --- Polished AI Help ---
    function askAI(idx) {
      const content = document.getElementById(`sec${idx}`).innerText.trim();
      let suggestion = "";
      if (!content) {
        suggestion = "Try to start with a simple statement about this section. For example: 'This report analyzes ...'";
      } else if (content.length < 30) {
        suggestion = "Consider expanding your statement with more detail. Provide additional context or examples.";
      } else if (/requirement|design|test/i.test(content)) {
        suggestion = "Ensure you clearly list any requirements, design principles, or test procedures. Try bullet points for clarity.";
      } else if (/conclusion|summary|recommend/i.test(content)) {
        suggestion = "Summarize your main findings or recommendations in a clear, concise way.";
      } else {
        suggestion = "Your statement looks good. Consider double-checking for clarity, completeness, and technical accuracy.";
      }
      showAIPopup(suggestion);
    }
    function showAIPopup(text) {
      document.getElementById('aiContent').innerHTML = text;
      document.getElementById('aiPopup').classList.remove('hidden');
    }
    // Reliable event binding for Close button
    document.getElementById('closeAIPopupBtn').onclick = function() {
      document.getElementById('aiPopup').classList.add('hidden');
      document.getElementById('aiContent').innerHTML = "";
    };
  </script>
</body>
</html>
